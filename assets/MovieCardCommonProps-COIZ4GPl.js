import{r as o,j as e,B as n,I as d,L as N,u as g,a as p,A as f,R as y,t as w,d as C,e as F,g as k,h as L}from"./index-Cp4Kj-5H.js";function S(s){const r=/^.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#&?]*).*/,a=s.match(r);return a&&a[1].length===11?a[1]:null}const T=({url:s,onClose:r})=>{const a=S(s),[t,l]=o.useState(!0);return a?e.jsx("div",{className:"trailer",children:e.jsx("div",{className:"container",onClick:c=>c.stopPropagation(),children:e.jsxs("div",{className:"trailer__content",children:[e.jsx(n,{className:"trailer__close",type:"button",onClick:r,children:e.jsx(d,{className:"trailer__close-icon",name:"close"})}),e.jsxs("div",{className:"trailer__box",children:[t&&e.jsx(N,{}),e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${a}`,title:"YouTube video player",frameBorder:"0",onLoad:()=>l(!1),allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{display:t?"none":"block"}})]})]})})}):null},I=({movie:s,onResetMovie:r,showDetails:a})=>{var u;const t=g(),[l,c]=o.useState(!1),[_,m]=o.useState(!1),{user:j}=p(i=>i.auth),x=p(i=>i.favorites.favorites),h=Array.isArray(x)&&x.some(i=>i.id===s.id),v=()=>{c(!0)},b=async()=>{j?(h?await t(F({id:s.id.toString()})):await t(k({id:s.id.toString()})),t(L())):m(!0)};return e.jsxs(e.Fragment,{children:[l&&e.jsx(T,{url:s.trailerUrl,onClose:()=>c(!1)}),_&&e.jsx(f,{onClose:()=>m(!1)}),e.jsxs("div",{className:"movie-card",children:[e.jsxs("div",{className:"movie-card__details",children:[e.jsxs("div",{className:"movie-card__info",children:[e.jsxs("div",{className:"movie-card__meta",children:[e.jsx(y,{tmdbRating:s.tmdbRating}),e.jsx("span",{className:"movie-card__year",children:s.releaseYear}),e.jsx("span",{className:"movie-card__genre",children:(u=s.genres)==null?void 0:u[0]}),e.jsx("span",{className:"movie-card__runtime",children:w(s.runtime)})]}),e.jsx("h1",{className:"movie-card__title",children:s.title}),e.jsx("p",{className:"movie-card__description",children:s.plot})]}),e.jsxs("div",{className:"movie-card__actions",children:[e.jsx(n,{className:"btn btn--trailer",onClick:v,children:"Трейлер"}),a&&e.jsx(C,{className:"btn btn--Onyx",to:`movie/${s.id}`,children:"О фильме"}),e.jsx(n,{className:"btn btn--Onyx btn--icon","aria-label":"добавить в избранне",onClick:b,children:e.jsx(d,{className:"movie-card__actions-icon",name:`${h?"favoriteTrue":"favorite"}`})}),r&&e.jsx(n,{className:"btn btn--Onyx btn--icon",onClick:r,"aria-label":"менять филм",children:e.jsx(d,{className:"movie-card__actions-icon",name:"reset"})})]})]}),e.jsx("div",{className:"movie-card__poster",children:e.jsx("div",{className:"movie-card__poster-img",children:e.jsx("img",{src:s.posterUrl?s.posterUrl:"/empty.png",alt:s.title})})})]})]})};export{I as M};
